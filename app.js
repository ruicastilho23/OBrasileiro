// Content Data - All website content stored here
const contentData = {
  "homepage": {
    "meta": {
      "title": "O Brasileiro - Authentic Brazilian Food Koh Phangan | Brazilian Pies Thailand",
      "description": "Discover authentic Brazilian cuisine at O Brasileiro in Srithanu Market, Koh Phangan. Best Brazilian pies, fresh açaí bowls, and traditional flavors in Thailand.",
      "keywords": "Brazilian food Koh Phangan, Brazilian pies Thailand, authentic Brazilian cuisine"
    },
    "hero": {
      "backgroundImage": "photos/imagehomepage1.png",
      "headline": "O Brasileiro: Sabor e Alegria",
      "subtitle": "Authentic Brazilian flavors in the heart of Koh Phangan",
      "ctaText": "Explore Our Menu",
      "ctaLink": "#menu"
    },
    "highlights": [
      {
        "title": "Authentic Brazilian Pies",
        "description": "Traditional pies made fresh daily with authentic recipes passed down through generations"
      },
      {
        "title": "Fresh Tropical Ingredients", 
        "description": "We use the finest local and imported ingredients to create genuine Brazilian flavors"
      },
      {
        "title": "Daily Specials",
        "description": "New creations and seasonal favorites that celebrate Brazilian culinary traditions"
      }
    ],
    "testimonials": [
      {
        "name": "Sarah M.",
        "location": "Australia", 
        "text": "The best pie I've had outside of São Paulo! Authentic flavors and perfect crispy texture.",
        "rating": 5
      },
      {
        "name": "Carlos R.",
        "location": "Brazil",
        "text": "Finally found real Brazilian food in Thailand! The açaí bowl tastes just like home.",
        "rating": 5  
      },
      {
        "name": "Emma K.",
        "location": "Germany",
        "text": "Amazing chicken pie and the friendliest service. This place captures the joy of Brazilian culture!",
        "rating": 5
      },
      {
        "name": "Miguel S.", 
        "location": "Spain",
        "text": "Incredible flavors and such fresh ingredients. The cheese and corn cake is absolutely perfect!",
        "rating": 5
      }
    ],
    "brandMessage": "O Brasileiro is the best spot for Brazilian food and authentic pies in Koh Phangan."
  },
  "menu": {
    "meta": {
      "title": "Menu - O Brasileiro | Best Pies Koh Phangan | Brazilian Snacks Thailand",
      "description": "Explore our authentic Brazilian menu featuring traditional pies, açaí bowls, fresh salads and desserts. Best Brazilian snacks in Koh Phangan, Thailand.",
      "keywords": "best pies Koh Phangan, Brazilian snacks Thailand, authentic Brazilian dishes"
    },
    "heroProducts": [
      {
        "name": "Chicken Pie with Salad",
        "image": "photos/piesalad.jpg",
        "description": "Our signature traditional chicken pie served with fresh mixed salad"
      },
      {
        "name": "Our House Salad (Vegan)",
        "image": "photos/housesalad.jpg", 
        "description": "Delicious plant-based option with seasoned fruits"
      },
      {
        "name": "Açaí Bowl",
        "image": "https://pplx-res.cloudinary.com/image/upload/v1755071131/pplx_project_search_images/7b6384b44103d0901eb5a9fb6352615b7a73d625.png",
        "description": "Authentic Brazilian superfood bowl with fresh tropical fruits"
      }
    ],
    "categories": [
      {
        "name": "Pies (Classic)",
        "items": [
          {"name": "Traditional Chicken", "price": 80, "currency": "THB"},
          {"name": "Corn & Chicken", "price": 80, "currency": "THB"},
          {"name": "Creamy Cheese & Chicken", "price": 85, "currency": "THB"},
          {"name": "Thai Chicken Curry", "price": 85, "currency": "THB"},
          {"name": "Tofu & Mushroom (V)", "price": 95, "currency": "THB"}
        ]
      },
      {
        "name": "Pies (Gluten & Lactose Free)",
        "items": [
          {"name": "Traditional Chicken", "price": 90, "currency": "THB"},
          {"name": "Corn & Chicken", "price": 90, "currency": "THB"},
          {"name": "Creamy Cheese & Chicken", "price": 95, "currency": "THB"},
          {"name": "Thai Chicken Curry", "price": 95, "currency": "THB"},
          {"name": "Tofu & Mushroom (V)", "price": 100, "currency": "THB"},
          {"name": "Spicy Fish", "price": 95, "currency": "THB"},
          {"name": "Pad Kra Pao (Pork)", "price": 95, "currency": "THB"}
        ]
      },
      {
        "name": "Sides", 
        "items": [
          {"name": "Salad", "price": 60, "currency": "THB"},
          {"name": "French Fries", "price": 70, "currency": "THB"}
        ]
      },
      {
        "name": "Salads",
        "items": [
          {"name": "Chicken & Ham", "price": 160, "currency": "THB", "description": "Marinated chicken, romaine lettuce, carrots, corn, ham, black olives, croutons, cherry tomatoes (Caesar dressing)"},
          {"name": "Tofu & Mushroom (V)", "price": 150, "currency": "THB", "description": "Tofu, shiitake mushroom, carrots, romaine lettuce, scallions, roasted peanuts (Miso dressing)"},
          {"name": "Tropical Shrimp", "price": 160, "currency": "THB", "description": "Shrimps, romaine lettuce, rocket, cherry tomatoes, red onion, pineapple, mango (Classic vinaigrette)"},
          {"name": "House Salad (V)", "price": 140, "currency": "THB", "description": "Mixed leaves, mustard seeds, sunflower sprouts, carrot, seasonal fruits, crunchy nuts (Pickled vinaigrette)"}
        ]
      },
      {
        "name": "Specials",
        "items": [
          {"name": "Chicken Milanesa", "price": 160, "currency": "THB"}
        ]
      },
      {
        "name": "Desserts", 
        "items": [
          {"name": "Carrot & Chocolate Syrup (Lactose Free)", "price": 65, "currency": "THB"},
          {"name": "Corn & Coconut (Gluten & Lactose Free)", "price": 65, "currency": "THB"},
          {"name": "Corn & Cheese (Gluten Free)", "price": 65, "currency": "THB"},
          {"name": "Cold Coconut Cake", "price": 75, "currency": "THB"}
        ]
      }
    ]
  },
  "about": {
    "meta": {
      "title": "O Brasileiro | Brazilian Culture Koh Phangan | Brazilian Restaurant Thailand",
      "description": "Learn the story of O Brasileiro, bringing authentic Brazilian flavors and culture to Koh Phangan. Discover our passion for traditional recipes and Brazilian hospitality.",
      "keywords": "Brazilian culture Koh Phangan, Brazilian restaurant Thailand"
    },
    "story": {
      "title": "Our Story: Bringing Brazil to Koh Phangan",
      "content": "At O Brasileiro, we believe that food is more than just nourishment – it's a bridge between cultures, a way to share joy, and a celebration of life itself. Our journey began with a simple dream: to bring the authentic flavors and warm hospitality of Brazil to the beautiful island of Koh Phangan.\n\nFounded by passionate food lovers who grew up surrounded by the rich culinary traditions of Brazil, O Brasileiro represents years of perfecting family recipes and understanding what makes Brazilian street food so special. Every pastel we serve carries the soul of Brazilian street markets, from the bustling feiras of São Paulo to the beach kiosks of Rio de Janeiro.\n\nOur commitment to authenticity goes beyond just taste. We source the finest ingredients, both local Thai produce and carefully selected Brazilian imports, to ensure every bite transports you to the vibrant streets of Brazil. The crispy, golden pastéis are made using traditional techniques passed down through generations, while our açaí bowls celebrate the superfood that has been nourishing Brazilians for centuries.\n\nWhat sets us apart is our dedication to the Brazilian spirit of 'alegria' – joy and warmth in everything we do. Whether you're a Brazilian missing the flavors of home, a traveler eager to explore new cuisines, or a local food enthusiast, we welcome you with open arms and the promise of an authentic Brazilian experience.\n\nLocated in the heart of Srithanu Market, O Brasileiro has become more than just a food stall – we're a cultural ambassador, sharing the richness of Brazilian cuisine with the diverse community of Koh Phangan. Every day, we're honored to serve guests from around the world, creating connections through the universal language of delicious food."
    },
    "values": [
      {
        "title": "Authenticity", 
        "description": "Every recipe is rooted in Brazilian tradition, using methods and ingredients that honor our culinary heritage"
      },
      {
        "title": "Quality",
        "description": "We source only the finest ingredients and prepare everything fresh daily to ensure the highest quality experience"
      },
      {
        "title": "Community",
        "description": "We're proud to be part of the Koh Phangan community, bringing people together through the joy of Brazilian food"
      },
      {
        "title": "Sustainability", 
        "description": "We support local suppliers and use environmentally conscious practices wherever possible"
      }
    ]
  },
  "gallery": {
    "meta": {
      "title": "Gallery - O Brasileiro | Brazilian Street Food Thailand | Tropical Food Experience Koh Phangan",
      "description": "See our delicious Brazilian pies, açaí bowls, and classic cakes. Experience authentic Brazilian street food in beautiful Koh Phangan.",
      "keywords": "Brazilian street food Thailand, tropical food experience Koh Phangan"
    },
    "images": [
      {
        "url": "photos/pies.jpg",
        "caption": "Fresh golden pies - our signature Brazilian pies made daily",
        "alt": "Golden crispy Brazilian pies displayed at O Brasileiro"
      },
      {
        "url": "https://pplx-res.cloudinary.com/image/upload/v1755852822/pplx_project_search_images/b2f702dae1e2dbbe3aa041234ded2b0691e123bd.png", 
        "caption": "Authentic açaí bowls topped with fresh tropical fruits",
        "alt": "Beautiful açaí bowl with tropical fruits at O Brasileiro"
      },
      {
        "url": "photos/chocolatecake.jpg",
        "caption": "Classic Brazilian cakes - Carrot & Chocolate", 
        "alt": "Bustling market atmosphere at O Brasileiro Srithanu Market"
      }
    ]
  },
  "contact": {
    "meta": {
      "title": "Contact O Brasileiro | Where to Eat Koh Phangan | Brazilian Restaurant Srithanu",  
      "description": "Visit O Brasileiro at Srithanu Market, Koh Phangan. Find us on social media for daily specials and events. Best Brazilian food in Thailand.",
      "keywords": "where to eat Koh Phangan, Brazilian restaurant Srithanu"
    },
    "location": {
      "name": "O Brasileiro",
      "address": "Srithanu Market, Koh Phangan, Surat Thani, Thailand +66 623 923 195",
      "coordinates": {
        "lat": 9.7756,
        "lng": 100.0581
      }
    },
    "social": [
      {
        "platform": "Instagram",
        "handle": "@obrasileiro_kpg",
        "url": "https://instagram.com/obrasileiro_kpg"
      },
      {
        "platform": "TikTok", 
        "handle": "@obrasileiro_kpg",
        "url": "https://tiktok.com/@obrasileiro_kpg"
      }
    ],
    "hours": {
      "monday": "3:00 PM - 11:00 PM",
      "tuesday": "3:00 PM - 11:00 PM", 
      "wednesday": "3:00 PM - 11:00 PM",
      "thursday": "3:00 PM - 11:00 PM",
      "friday": "3:00 AM - 11:00 PM",
      "saturday": "3:00 AM - 11:00 PM",
      "sunday": "3:00 AM - 11:00 PM"
    },
    "specialNote": "Follow us on social media for daily specials, new menu items, and special events!"
  },
  "global": {
    "siteName": "O Brasileiro", 
    "tagline": "Sabor e Alegria",
    "brandMessage": "O Brasileiro is the best spot for Brazilian food and authentic pies in Koh Phangan.",
    "colors": {
      "primary": "#228B22",
      "secondary": "#FFD700", 
      "accent": "#0038A8",
      "white": "#FFFFFF",
      "text": "#333333"
    },
    "adminPassword": "admin123"
  }
};

// Application State
let isAdminMode = false;
let currentEditingElement = null;

// DOM Elements
let navLinks, pages, adminBtn, adminModal, adminControls, imageModal;

// Initialize Application
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing app...');
    loadSavedContent();
    initializeElements();
    loadContent();
    setupEventListeners();
    initializeNavigation();
    console.log('App initialization complete');
});

function initializeElements() {
    navLinks = document.querySelectorAll('.nav-link');
    pages = document.querySelectorAll('.page');
    adminBtn = document.getElementById('admin-btn');
    adminModal = document.getElementById('admin-modal');
    adminControls = document.getElementById('admin-controls');
    imageModal = document.getElementById('image-modal');
    
    console.log('Elements initialized:', { navLinks: navLinks.length, pages: pages.length });
}

function loadContent() {
    loadHomepageContent();
    loadMenuContent();
    loadAboutContent();
    loadGalleryContent();
    loadContactContent();
    loadGlobalContent();
    console.log('Content loaded');
}

function loadHomepageContent() {
    const homepage = contentData.homepage;
    
    // Update meta tags
    document.title = homepage.meta.title;
    const metaDesc = document.querySelector('meta[name="description"]');
    const metaKeywords = document.querySelector('meta[name="keywords"]');
    if (metaDesc) metaDesc.content = homepage.meta.description;
    if (metaKeywords) metaKeywords.content = homepage.meta.keywords;
    
    // Load hero content
    const hero = document.querySelector('.hero');
    if (hero) {
        hero.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('${homepage.hero.backgroundImage}')`;
        hero.setAttribute('data-editable-image', 'backgroundImage');
    }
    
    setTextContent('[data-editable="headline"]', homepage.hero.headline);
    setTextContent('[data-editable="subtitle"]', homepage.hero.subtitle);
    setTextContent('[data-editable="ctaText"]', homepage.hero.ctaText);
    
    // Load highlights
    homepage.highlights.forEach((highlight, index) => {
        setTextContent(`[data-editable-section="highlight-${index}"] [data-editable="title"]`, highlight.title);
        setTextContent(`[data-editable-section="highlight-${index}"] [data-editable="description"]`, highlight.description);
    });
    
    // Load testimonials
    homepage.testimonials.forEach((testimonial, index) => {
        setTextContent(`[data-editable-section="testimonial-${index}"] [data-editable="text"]`, testimonial.text);
        setTextContent(`[data-editable-section="testimonial-${index}"] [data-editable="name"]`, testimonial.name);
        setTextContent(`[data-editable-section="testimonial-${index}"] [data-editable="location"]`, testimonial.location);
    });
    
    setTextContent('[data-editable="brandMessage"]', homepage.brandMessage);
}

function loadMenuContent() {
    const menu = contentData.menu;
    
    // Load hero products
    menu.heroProducts.forEach((product, index) => {
        const section = document.querySelector(`[data-editable-section="hero-product-${index}"]`);
        if (section) {
            const img = section.querySelector('img');
            if (img) {
                img.src = product.image;
                img.setAttribute('data-editable-image', 'image');
            }
            setTextContent(`[data-editable-section="hero-product-${index}"] [data-editable="name"]`, product.name);
            setTextContent(`[data-editable-section="hero-product-${index}"] [data-editable="description"]`, product.description);
        }
    });
    
    // Generate menu categories
    const menuContainer = document.getElementById('menu-categories');
    if (menuContainer) {
        menuContainer.innerHTML = '';
        
        menu.categories.forEach((category, categoryIndex) => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'menu-category';
            categoryDiv.setAttribute('data-editable-section', `category-${categoryIndex}`);
            
            const categoryHeader = document.createElement('h3');
            categoryHeader.textContent = category.name;
            categoryHeader.setAttribute('data-editable', 'name');
            categoryDiv.appendChild(categoryHeader);
            
            const itemsDiv = document.createElement('div');
            itemsDiv.className = 'menu-items';
            
            category.items.forEach((item, itemIndex) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'menu-item';
                itemDiv.setAttribute('data-editable-section', `category-${categoryIndex}-item-${itemIndex}`);
                
                const itemInfo = document.createElement('div');
                itemInfo.className = 'menu-item-info';
                
                const itemName = document.createElement('div');
                itemName.className = 'menu-item-name';
                itemName.textContent = item.name;
                itemName.setAttribute('data-editable', 'name');
                itemInfo.appendChild(itemName);
                
                if (item.description) {
                    const itemDesc = document.createElement('div');
                    itemDesc.className = 'menu-item-description';
                    itemDesc.textContent = item.description;
                    itemDesc.setAttribute('data-editable', 'description');
                    itemInfo.appendChild(itemDesc);
                }
                
                const itemPrice = document.createElement('div');
                itemPrice.className = 'menu-item-price';
                itemPrice.textContent = `${item.price} ${item.currency}`;
                itemPrice.setAttribute('data-editable', 'price');
                
                itemDiv.appendChild(itemInfo);
                itemDiv.appendChild(itemPrice);
                itemsDiv.appendChild(itemDiv);
            });
            
            categoryDiv.appendChild(itemsDiv);
            menuContainer.appendChild(categoryDiv);
        });
    }
}

function loadAboutContent() {
    const about = contentData.about;
    
    setTextContent('[data-editable="story-title"]', about.story.title);
    
    // Handle multi-paragraph story content
    const storyContent = document.querySelector('[data-editable="story-content"]');
    if (storyContent) {
        const paragraphs = about.story.content.split('\n\n');
        storyContent.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
    }
    
    // Load values
    about.values.forEach((value, index) => {
        setTextContent(`[data-editable-section="value-${index}"] [data-editable="title"]`, value.title);
        setTextContent(`[data-editable-section="value-${index}"] [data-editable="description"]`, value.description);
    });
}

function loadGalleryContent() {
    const gallery = contentData.gallery;
    
    gallery.images.forEach((image, index) => {
        const section = document.querySelector(`[data-editable-section="gallery-${index}"]`);
        if (section) {
            const img = section.querySelector('img');
            if (img) {
                img.src = image.url;
                img.alt = image.alt;
                img.setAttribute('data-editable-image', 'url');
            }
            setTextContent(`[data-editable-section="gallery-${index}"] [data-editable="caption"]`, image.caption);
        }
    });
}

function loadContactContent() {
    const contact = contentData.contact;
    
    setTextContent('[data-editable="address"]', contact.location.address);
    setTextContent('[data-editable="weekday"]', '3:00 PM - 11:00 PM');
    setTextContent('[data-editable="weekend"]', '3:00 PM - 11:00 PM');
    setTextContent('[data-editable="instagram-handle"]', contact.social[0].handle);
    setTextContent('[data-editable="tiktok-handle"]', contact.social[1].handle);
    setTextContent('[data-editable="specialNote"]', contact.specialNote);
}

function loadGlobalContent() {
    const global = contentData.global;
    
    setTextContent('[data-editable="siteName"]', global.siteName);
    setTextContent('[data-editable="tagline"]', global.tagline);
}

function setTextContent(selector, content) {
    const element = document.querySelector(selector);
    if (element) {
        element.textContent = content;
    }
}

function setupEventListeners() {
    console.log('Setting up event listeners...');
    
    // Navigation
    navLinks.forEach(link => {
        link.addEventListener('click', handleNavigation);
    });
    
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
    }
    
    // Admin functionality
    if (adminBtn) {
        adminBtn.addEventListener('click', showAdminModal);
    }
    
    // Admin modal buttons
    const loginBtn = document.getElementById('login-admin');
    const cancelBtn = document.getElementById('cancel-admin');
    const saveBtn = document.getElementById('save-changes');
    const exitBtn = document.getElementById('exit-admin');
    
    if (loginBtn) loginBtn.addEventListener('click', handleAdminLogin);
    if (cancelBtn) cancelBtn.addEventListener('click', hideAdminModal);
    if (saveBtn) saveBtn.addEventListener('click', saveChanges);
    if (exitBtn) exitBtn.addEventListener('click', exitAdminMode);
    
    // Image modal buttons
    const updateImageBtn = document.getElementById('update-image');
    const cancelImageBtn = document.getElementById('cancel-image');
    
    if (updateImageBtn) updateImageBtn.addEventListener('click', updateImage);
    if (cancelImageBtn) cancelImageBtn.addEventListener('click', hideImageModal);
    
    // Close modals
    document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        });
    });
    
    // Close modals on outside click
    if (adminModal) {
        adminModal.addEventListener('click', (e) => {
            if (e.target === adminModal) {
                hideAdminModal();
            }
        });
    }
    
    if (imageModal) {
        imageModal.addEventListener('click', (e) => {
            if (e.target === imageModal) {
                hideImageModal();
            }
        });
    }
    
    // Hero CTA link
    const heroCta = document.querySelector('.hero-cta');
    if (heroCta) {
        heroCta.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('menu');
        });
    }
    
    // Handle Enter key in admin password field
    const passwordField = document.getElementById('admin-password');
    if (passwordField) {
        passwordField.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleAdminLogin();
            }
        });
    }
    
    console.log('Event listeners set up complete');
}

function handleNavigation(e) {
    e.preventDefault();
    const href = e.target.getAttribute('href');
    if (href && href.startsWith('#')) {
        const targetPage = href.substring(1);
        console.log('Navigating to:', targetPage);
        showPage(targetPage);
        
        // Update URL hash
        window.location.hash = targetPage;
    }
}

function showPage(pageId) {
    console.log('Showing page:', pageId);
    
    // Hide all pages
    pages.forEach(page => {
        page.classList.remove('active');
        console.log('Hiding page:', page.id);
    });
    
    // Show target page
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active');
        console.log('Showing page:', targetPage.id);
    } else {
        console.error('Page not found:', pageId);
        // Fallback to home page
        const homePage = document.getElementById('home');
        if (homePage) {
            homePage.classList.add('active');
        }
    }
    
    // Update navigation active state
    navLinks.forEach(link => {
        link.classList.remove('active');
        const href = link.getAttribute('href');
        if (href === `#${pageId}`) {
            link.classList.add('active');
        }
    });
    
    // Close mobile menu
    const navMenu = document.querySelector('.nav-menu');
    if (navMenu) {
        navMenu.classList.remove('active');
    }
    
    // Scroll to top
    window.scrollTo(0, 0);
}

function initializeNavigation() {
    // Check URL hash on load
    let hash = window.location.hash.substring(1);
    if (!hash) {
        hash = 'home';
        window.location.hash = 'home';
    }
    
    console.log('Initial hash:', hash);
    
    // Verify page exists
    const targetPage = document.getElementById(hash);
    if (targetPage) {
        showPage(hash);
    } else {
        showPage('home');
        window.location.hash = 'home';
    }
    
    // Handle browser back/forward
    window.addEventListener('hashchange', () => {
        const newHash = window.location.hash.substring(1);
        console.log('Hash changed to:', newHash);
        if (newHash && document.getElementById(newHash)) {
            showPage(newHash);
        }
    });
}

// Admin Functions
function showAdminModal() {
    console.log('Showing admin modal');
    if (adminModal) {
        adminModal.classList.remove('hidden');
        const passwordField = document.getElementById('admin-password');
        if (passwordField) {
            passwordField.focus();
        }
    }
}

function hideAdminModal() {
    console.log('Hiding admin modal');
    if (adminModal) {
        adminModal.classList.add('hidden');
        const passwordField = document.getElementById('admin-password');
        const errorDiv = document.getElementById('admin-error');
        if (passwordField) passwordField.value = '';
        if (errorDiv) errorDiv.classList.add('hidden');
    }
}

function handleAdminLogin() {
    console.log('Handling admin login');
    const passwordField = document.getElementById('admin-password');
    const errorDiv = document.getElementById('admin-error');
    
    if (!passwordField || !errorDiv) {
        console.error('Admin login elements not found');
        return;
    }
    
    const password = passwordField.value;
    console.log('Password attempt:', password ? 'provided' : 'empty');
    
    if (password === contentData.global.adminPassword) {
        console.log('Password correct, entering admin mode');
        hideAdminModal();
        enterAdminMode();
    } else {
        console.log('Password incorrect');
        errorDiv.classList.remove('hidden');
        passwordField.value = '';
        passwordField.focus();
    }
}

function enterAdminMode() {
    console.log('Entering admin mode');
    isAdminMode = true;
    document.body.classList.add('admin-mode');
    
    if (adminBtn) adminBtn.style.display = 'none';
    if (adminControls) adminControls.classList.remove('hidden');
    
    // Make elements editable
    setupEditableElements();
    
    // Show admin notification
    showNotification('Admin mode activated. Click on text to edit, click on images to change them.', 'success');
}

function exitAdminMode() {
    console.log('Exiting admin mode');
    isAdminMode = false;
    document.body.classList.remove('admin-mode');
    
    if (adminBtn) adminBtn.style.display = 'block';
    if (adminControls) adminControls.classList.add('hidden');
    
    // Remove editable event listeners
    document.querySelectorAll('[data-editable]').forEach(element => {
        element.removeEventListener('click', handleEditableClick);
    });
    
    document.querySelectorAll('[data-editable-image]').forEach(element => {
        element.removeEventListener('click', handleImageClick);
    });
    
    showNotification('Admin mode deactivated', 'info');
}

function setupEditableElements() {
    console.log('Setting up editable elements');
    
    // Text elements
    document.querySelectorAll('[data-editable]').forEach(element => {
        element.addEventListener('click', handleEditableClick);
    });
    
    // Image elements
    document.querySelectorAll('[data-editable-image]').forEach(element => {
        element.addEventListener('click', handleImageClick);
    });
    
    console.log('Editable elements set up');
}

function handleEditableClick(e) {
    if (!isAdminMode) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    console.log('Editing element:', e.target);
    
    const element = e.target;
    const currentText = element.textContent;
    
    // Create inline editor
    const input = document.createElement('input');
    input.type = 'text';
    input.value = currentText;
    input.className = 'inline-editor';
    input.style.cssText = `
        width: 100%;
        padding: 0.5rem;
        border: 2px solid var(--brazilian-green);
        border-radius: 4px;
        font-size: inherit;
        font-family: inherit;
        background: white;
        z-index: 1001;
        position: relative;
    `;
    
    element.style.display = 'none';
    element.parentNode.insertBefore(input, element.nextSibling);
    input.focus();
    input.select();
    
    function saveEdit() {
        element.textContent = input.value;
        element.style.display = '';
        input.remove();
        updateContentData(element, input.value);
        showNotification('Text updated', 'success');
    }
    
    function cancelEdit() {
        element.style.display = '';
        input.remove();
    }
    
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            saveEdit();
        } else if (e.key === 'Escape') {
            cancelEdit();
        }
    });
    
    input.addEventListener('blur', saveEdit);
}

function handleImageClick(e) {
    if (!isAdminMode) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    console.log('Editing image:', e.target);
    
    currentEditingElement = e.target;
    const currentSrc = getCurrentImageSrc(currentEditingElement);
    
    const urlField = document.getElementById('image-url');
    const previewImg = document.getElementById('current-image-preview');
    
    if (urlField) urlField.value = currentSrc;
    if (previewImg) previewImg.src = currentSrc;
    
    if (imageModal) {
        imageModal.classList.remove('hidden');
    }
}

function getCurrentImageSrc(element) {
    if (element.tagName === 'IMG') {
        return element.src;
    } else if (element.classList.contains('hero')) {
        const bgImage = getComputedStyle(element).backgroundImage;
        const match = bgImage.match(/url\(['"]?([^'"]+)['"]?\)/);
        return match ? match[1] : '';
    }
    return '';
}

function hideImageModal() {
    if (imageModal) {
        imageModal.classList.add('hidden');
    }
    currentEditingElement = null;
}

function updateImage() {
    const urlField = document.getElementById('image-url');
    if (!urlField || !currentEditingElement) return;
    
    const newUrl = urlField.value.trim();
    if (!newUrl) {
        showNotification('Please enter a valid image URL', 'error');
        return;
    }
    
    console.log('Updating image to:', newUrl);
    
    if (currentEditingElement.tagName === 'IMG') {
        currentEditingElement.src = newUrl;
    } else if (currentEditingElement.classList.contains('hero')) {
        currentEditingElement.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('${newUrl}')`;
    }
    
    updateImageContentData(currentEditingElement, newUrl);
    hideImageModal();
    showNotification('Image updated', 'success');
}

function updateContentData(element, newValue) {
    const editableType = element.getAttribute('data-editable');
    const section = element.closest('[data-editable-section]');
    
    console.log('Updating content data:', { editableType, section: section ? section.getAttribute('data-editable-section') : null, newValue });
    
    if (section) {
        const sectionId = section.getAttribute('data-editable-section');
        updateSectionData(sectionId, editableType, newValue);
    } else {
        updateGlobalData(editableType, newValue);
    }
}

function updateImageContentData(element, newUrl) {
    const imageType = element.getAttribute('data-editable-image');
    const section = element.closest('[data-editable-section]');
    
    console.log('Updating image data:', { imageType, section: section ? section.getAttribute('data-editable-section') : null, newUrl });
    
    if (section) {
        const sectionId = section.getAttribute('data-editable-section');
        updateSectionImageData(sectionId, imageType, newUrl);
    } else if (imageType === 'backgroundImage') {
        contentData.homepage.hero.backgroundImage = newUrl;
    }
}

function updateSectionData(sectionId, field, value) {
    if (sectionId.startsWith('highlight-')) {
        const index = parseInt(sectionId.split('-')[1]);
        if (contentData.homepage.highlights[index]) {
            contentData.homepage.highlights[index][field] = value;
        }
    } else if (sectionId.startsWith('testimonial-')) {
        const index = parseInt(sectionId.split('-')[1]);
        if (contentData.homepage.testimonials[index]) {
            contentData.homepage.testimonials[index][field] = value;
        }
    } else if (sectionId.startsWith('hero-product-')) {
        const index = parseInt(sectionId.split('-')[2]);
        if (contentData.menu.heroProducts[index]) {
            contentData.menu.heroProducts[index][field] = value;
        }
    } else if (sectionId.startsWith('value-')) {
        const index = parseInt(sectionId.split('-')[1]);
        if (contentData.about.values[index]) {
            contentData.about.values[index][field] = value;
        }
    } else if (sectionId.startsWith('gallery-')) {
        const index = parseInt(sectionId.split('-')[1]);
        if (contentData.gallery.images[index]) {
            contentData.gallery.images[index][field] = value;
        }
    } else if (sectionId.startsWith('category-')) {
        const parts = sectionId.split('-');
        const categoryIndex = parseInt(parts[1]);
        if (parts.length === 2) {
            // Category name
            if (contentData.menu.categories[categoryIndex]) {
                contentData.menu.categories[categoryIndex][field] = value;
            }
        } else if (parts.length === 4) {
            // Menu item
            const itemIndex = parseInt(parts[3]);
            if (contentData.menu.categories[categoryIndex] && contentData.menu.categories[categoryIndex].items[itemIndex]) {
                if (field === 'price') {
                    const priceMatch = value.match(/(\d+)/);
                    if (priceMatch) {
                        contentData.menu.categories[categoryIndex].items[itemIndex].price = parseInt(priceMatch[1]);
                    }
                } else {
                    contentData.menu.categories[categoryIndex].items[itemIndex][field] = value;
                }
            }
        }
    }
}

function updateSectionImageData(sectionId, field, value) {
    if (sectionId.startsWith('hero-product-')) {
        const index = parseInt(sectionId.split('-')[2]);
        if (contentData.menu.heroProducts[index]) {
            contentData.menu.heroProducts[index][field] = value;
        }
    } else if (sectionId.startsWith('gallery-')) {
        const index = parseInt(sectionId.split('-')[1]);
        if (contentData.gallery.images[index]) {
            contentData.gallery.images[index][field] = value;
        }
    }
}

function updateGlobalData(field, value) {
    console.log('Updating global data:', field, value);
    
    if (field === 'siteName') {
        contentData.global.siteName = value;
    } else if (field === 'tagline') {
        contentData.global.tagline = value;
    } else if (field === 'brandMessage') {
        contentData.homepage.brandMessage = value;
    } else if (field === 'headline') {
        contentData.homepage.hero.headline = value;
    } else if (field === 'subtitle') {
        contentData.homepage.hero.subtitle = value;
    } else if (field === 'ctaText') {
        contentData.homepage.hero.ctaText = value;
    } else if (field === 'story-title') {
        contentData.about.story.title = value;
    } else if (field === 'address') {
        contentData.contact.location.address = value;
    } else if (field === 'specialNote') {
        contentData.contact.specialNote = value;
    } else if (field === 'instagram-handle') {
        contentData.contact.social[0].handle = value;
    } else if (field === 'tiktok-handle') {
        contentData.contact.social[1].handle = value;
    }
}

function saveChanges() {
    console.log('Saving changes');
    
    try {
        localStorage.setItem('obrasileiro-content', JSON.stringify(contentData));
        showNotification('Changes saved successfully!', 'success');
    } catch (error) {
        console.error('Error saving changes:', error);
        showNotification('Error saving changes. Please try again.', 'error');
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--brazilian-green)' : type === 'error' ? '#dc3545' : 'var(--brazilian-blue)'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        z-index: 3000;
        font-weight: bold;
        box-shadow: var(--shadow);
        max-width: 300px;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Load saved content on page load
function loadSavedContent() {
    try {
        const saved = localStorage.getItem('obrasileiro-content');
        if (saved) {
            const savedData = JSON.parse(saved);
            Object.assign(contentData, savedData);
            console.log('Saved content loaded');
        }
    } catch (e) {
        console.warn('Could not load saved content:', e);
    }
}
